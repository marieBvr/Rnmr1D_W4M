<tool id="Rnmr1D" name="Rnmr1D" version="0.0.0">
    <requirements>
	<requirement type="binary">Rscript</requirement>
    </requirements>

    <description>
	Processing and bucketing of 1D 1H-NMR Brucker raw data
    </description>

    <command interpreter="Rscript">
	Rnmr1D_parser.R -z ${inputzip} -s ${sample} -p ${macrocommand} -b ${bucketfile} -o "." -l ${output}
    </command>

    <stdio>
        <exit_code range="1:" />
        <exit_code range=":-1" />
        <regex match="Error:" />
        <regex match="Exception:" />
    </stdio>

    <inputs>
	<param name="inputzip" type="data" format="no_unzip.zip" label="Raw zip" help="Raw data of 1D 1H-NMR metabolomics experiment (Bruker)"/>	
	<param name="sample" type="data" format="tabular" label="Sample file (tabular format)"/>
	<param name="bucketfile" type="data" format="tabular" label="Bucket's areas file (tabular format)" help="Only two columns are allowed : 'min' and 'max'"/>
	<param name="macrocommand" type="data" format="text" label="Macro commands file (text format)" size="50"/>
    </inputs>

    <outputs>
	<data name="data_matrixOut" from_work_dir="dataMatrix.tsv" label="${tool.name}_dataMatrix" format="tabular"/>
	<data name="sampleMetadata" from_work_dir="sampleMetadata.tsv" label="${tool.name}_sampleMetadata" format="tabular"/>
	<data name="variableMetadata" from_work_dir="variableMetadata.tsv" label="${tool.name}_variableMetadata" format="tabular"/>
	<data name="output" from_work_dir="out.log" label="${tool.name}_out.log" format="txt"/>
    </outputs>

    <tests>
	<test>
	    <param name="inputzip" value="Tlse_BrainMice_Bpa0025Bpa025.zip"/>
	    <param name="sample" value="Tlse_BrainMice_Bpa0025_minus1.txt"/>
	    <param name="bucketfile" value="buckets_Tlse_BrainMice_Bpa0025Bpa025.txt"/>
	    <param name="macrocommand" value="procmd_Tlse_BrainMice_Bpa0025Bpa025.txt"/>
	    <output name="data_matrixOut" file="dataMatrix.tsv"/>
	    <output name="sampleMetadata" file="sampleMetadata.tsv"/>
	    <output name="variableMetadata" file="variableMetadata.tsv"/>
	</test>
    </tests>

    <citations>
    </citations>

    <help>
	.. class:: infomark

	**Authors**
	  | Daniel Jacob - Biologie du fruit et pathologie ; INRA ; MetaboHUB (for original version of this tool and overall development of the R script)
	  | daniel.jacob@bordeaux.inra.fr

	.. class:: infomark

	**Contributors**
	  | Marie Lefebvre - Biologie du fruit et pathologie ; INRA ; MetaboHUB  (for xml interface and R wrapper)
	  | marie.lefebvre@bordeaux.inra.fr

-----

===============
Rnmr1D
===============

------------
What it does
------------
   
This tool replays processing of NMR 1D 1H-NMR data through macro-command file generated by the online software 
NMRProcFlow http://linktonmrprocflow.org.

.. image:: ./static/images/metabolomics/fullprocessing_NMRProcFlow_logo.png
 	:width: 250

-----

-----------------
Workflow position
-----------------

**Upstream tools**

NA

.. class:: infomark

*To obtain the macro-command file you should first process on a dataset through NMRProcFlow* http://linktonmrprocflow.org



**Downstream tools**

+---------------------------+----------------------+--------+
| Name                      | Output file          | Format |
+===========================+======================+========+
|NmrNormalization           | dataMatrix.tsv       | Tabular|
+---------------------------+----------------------+--------+
|Univariate                 | variableMetadata.tsv | Tabular|
+---------------------------+----------------------+--------+
|Multivariate               | sampleMetadata.tsv   | Tabular|
+---------------------------+----------------------+--------+
|                           | variableMetadata.tsv | Tabular|
+---------------------------+----------------------+--------+

|
| Connexion of downstream tools

.. image:: ./static/images/metabolomics/Rnmr1D-workflowPosition.png
 	:width: 600

-----------
Input files
-----------

+--------------------------+-----------+
| File 		 	   |  Format   |
+==========================+===========+
| 1 : zip                  | zip       |
+--------------------------+-----------+
| 2 : sample               | tabular   |
+--------------------------+-----------+
| 3 : bucket area          | tabular   |
+--------------------------+-----------+
| 4 : macro-command        | text      |
+--------------------------+-----------+

----------
Parameters
----------

**Raw zip**
	| NMR 1D 1H-NMR raw data (Brucker), a ZIP that contains all your Brucker directories.
	|

**Sample file**
	| List of directories of the raw spectra contained in the ZIP file that will be processed, involving for each the sample name (SampleCode), the identifiers corresponding to the acquisition (expno) and treatment (procno).
	|

**Bucket's areas file**
	| List of buckets' areas (only min and max values are allowed) selected with NMRProcFlow.
	|

**Macro-commands file**
	| Processing commands applied on a dataset and generated by NMRProcFlow.
	|


-------
Outputs
-------

+-------------------------+----------+
| File 		 	  |  Format  |
+=========================+==========+
| 1 : dataMatrix          | tabular  |
+-------------------------+----------+
| 2 : sampleMetadata      | tabular  |
+-------------------------+----------+
| 3 : variableMetadata    | tabular  |
+-------------------------+----------+
| 4 : out.log             | text     |
+-------------------------+----------+


dataMatrix
	| Variable x sample *dataMatrix* tabular separated file of the numeric data matrix, with . as decimal, and NA for missing values. 
	| The table must not contain metadata apart from row and column names The row and column names must be identical to the rownames of the sample and variable metadata, respectively (see below)
	|

sampleMetadata
	| File with n rows (samples) and p columns (factors). 
	| This file is optional in the normalization step and mandatory in the statistical analysis step of the workflow.
	|

variableMetadata
	| File with q rows (buckets) and 2 columns containing variable identifier (rownames) and bucket order: the rownames of variableMetadata must be identical to the rownames of the bucketedData. 
	| This file is mandatory in the statistical analysis step of the workflow.


-----

---------------
Working example
---------------

.. class:: warningmark

Under construction



    </help>
</tool>
