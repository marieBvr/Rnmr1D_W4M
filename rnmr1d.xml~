<tool id="full_processing" name="Full processing" version="1.0">
    <description>
	Spectra processing from 1D 1H-NMR metabolomics data
    </description>
    <command interpreter="bash">
	rnmr1d.sh ${inputzip} ${sample} ${macrocommand} ${bucketfile} "."
    </command>
    <stdio>
        <exit_code range="1:" />
        <exit_code range=":-1" />
        <regex match="Error:" />
        <regex match="Exception:" />
    </stdio>
    <inputs>
	<param format="no_unzip.zip" name="inputzip" type="data" label="Raw zip" help="Raw data of 1D 1H-NMR metabolomics experiment (Bruker)"/>
	
	<param format="tabular" name="sample" type="data" label="Sample file (tabular format)"/>
	<param format="tabular" name="bucketfile" type="data" label="Bucket's zones file (tabular format)"/>
	<param format="text" name="macrocommand" type="data" label="Macro commands file (text format)" size="50"/>
    </inputs>
    <outputs>
	<data format="csv" name="samplesOut" from_work_dir="samples.csv" label="samples.csv"/>
	<data format="txt" name="data_matrixOut" from_work_dir="data_matrix.txt" label="data_matrix.txt"/>
	<data format="in" name="bucket_listOut" from_work_dir="bucket_list.in" label="bucket_list.in"/>
	<data format="txt" name="output" from_work_dir="out.log" label="out.log"/>
    </outputs>
    <tests>
	<test>
	    <param name="inputzip" value="Tlse_BrainMice_Bpa0025Bpa025.zip"/>
	    <param name="sample" value="Tlse_BrainMice_Bpa0025_minus1.txt"/>
	    <param name="bucketfile" value="buckets_Tlse_BrainMice_Bpa0025Bpa025.txt"/>
	    <param name="macrocommand" value="procmd_Tlse_BrainMice_Bpa0025Bpa025.txt"/>
	    <output name="samplesOut" file="samples.csv"/>
	    <output name="data_matrixOut" file="data_matrix.txt" compare="re_match" lines_diff="1"/>
	    <output name="bucket_listOut" file="bucket_list.in"/>
	    <output name="output" file="out.log"/>
	</test>
    </tests>
    <citations>
    </citations>
    <help>
	.. class:: infomark

	**Authors**
	  | Daniel Jacob - Biologie du fruit et pathologie ; INRA ; MetaboHUB (for original version of this tool and overall development of the R script)

	.. class:: infomark

	**Contributors**
	  | Marie Lefebvre - Biologie du fruit et pathologie ; INRA ; MetaboHUB  (for xml interface and wrapper)

-----

==============
Rnmr1D
==============

------------
What it does
------------
   
This tool replays processing of NMR 1D 1H-NMR data through macro-command file generated by the online software 
NMRProcFlow http://linktonmrprocflow.org.

.. class:: infomark 

[Citation NMRProcFlow]


-----

-----------
Input files
-----------

+-------------------------+-----------+-------------------------------------------------------------+
| File 		 	  |  Format   |	      Description                                           |
+=========================+===========+=============================================================+
| 1 : zip                 |    zip    |	NMR 1D 1H-NMR raw data (Brucker)                            |
+-------------------------+-----------+-------------------------------------------------------------+
|                         |           |	List of directories of the raw spectra contained in the ZIP | 
| 2 : sample              |  tabular  |	file that need to be treated, involving for each the sample |
|                         |           |	name (SampleCode), the identifiers corresponding to the     |
|                         |           |	acquisition (expno) and treatment (procno)	            |
+-------------------------+-----------+-------------------------------------------------------------+
| 3 : bucket zone         |  tabular  |	List of buckets (min and max) selected with NMRProcFlow     |
+-------------------------+-----------+-------------------------------------------------------------+
| 4 : macro command       |   text    |	Processing commands applied on a dataset and generated by   |
| 		          |           |	NMRProcFlow  						    |
+-------------------------+-----------+-------------------------------------------------------------+


.. class:: warningmark

File (2), (3) and (4) are generated by NMRProcFlow

-----

-------
Outputs
-------

+-------------------------+------------+-------------------------------------------------------------+
| File 		 	  |   Format   |	      Description                                    |
+=========================+============+=============================================================+
| 4 : samples.csv         |     csv    |			                                     |
+-------------------------+------------+-------------------------------------------------------------+
| 6 : list_pars.csv       |     csv    |			                                     |
+-------------------------+------------+-------------------------------------------------------------+
| 9 : data_matrix.txt     |     txt    |			                                     |
+-------------------------+------------+-------------------------------------------------------------+
| 10 : bucket_list.in     |     in     |			                                     |
+-------------------------+------------+-------------------------------------------------------------+
| 11 : out.log	          |     txt    | Message and warning of processing                           |
+-------------------------+------------+-------------------------------------------------------------+


    </help>
</tool>
